# feedback_module.py
# -----------------------------------------------------------------------------
# í”¼ë“œë°±ì„ êµ¬ë„/ê°ì„±/í¬ì¦ˆ/ìš”ì•½ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ê·¸ë£¹í™”í•´ì„œ ì •ë¦¬ ì¶œë ¥
# - ì‹œê°ì  êµ¬ë¶„ì´ ëª…í™•í•˜ì—¬ ì‚¬ìš©ì í”¼ë“œë°± ê°€ë…ì„± í–¥ìƒ
# - ê° ì¹´í…Œê³ ë¦¬ë³„ ë¬¸ì¥ ìˆ˜ì§‘ í›„ ì „ì²´ messagesë¡œ ë°˜í™˜
# -----------------------------------------------------------------------------

from typing import List, Optional

def generate_feedback(
    pose_conf: Optional[float] = None,
    composition_score: Optional[float] = None,
    emotion_score: Optional[float] = None,
    reasons: Optional[List[str]] = None,
    summary: Optional[str] = None
) -> List[str]:
    """ì¹´í…Œê³ ë¦¬ë³„ í”¼ë“œë°± ìƒì„±"""
    # ì¹´í…Œê³ ë¦¬ë³„ ì„ì‹œ ì €ì¥
    pose_msgs, comp_msgs, emo_msgs, summary_msgs = [], [], [], []

    # -------------------------------------------------------------------------
    # 1ï¸âƒ£ í¬ì¦ˆ ê´€ë ¨
    # -------------------------------------------------------------------------
    if pose_conf is not None:
        if pose_conf < 0.4:
            pose_msgs.append("ì‚¬ëŒ ì¸ì‹ì´ ë¶ˆì•ˆì •í•´ìš”. ì¹´ë©”ë¼ë¥¼ ì¡°ê¸ˆ ë” ê°€ê¹Œì´ í•˜ê±°ë‚˜ ì¡°ëª…ì„ ë°ê²Œ í•´ë³´ì„¸ìš”.")
        elif pose_conf < 0.7:
            pose_msgs.append("ì¸ì‹ì€ ë˜ì—ˆì§€ë§Œ ì •í™•ë„ê°€ ë‚®ì•„ìš”. í¬ì¦ˆë¥¼ ì¡°ê¸ˆ ë” ëª…í™•íˆ ì·¨í•´ë³´ì„¸ìš”.")
        else:
            pose_msgs.append("ì¸ë¬¼ ì¸ì‹ì´ ì•ˆì •ì ìœ¼ë¡œ ì˜ ë˜ì—ˆì–´ìš”.")

    # -------------------------------------------------------------------------
    # 2ï¸âƒ£ êµ¬ë„ ê´€ë ¨
    # -------------------------------------------------------------------------
    if reasons:
        comp_msgs.extend(reasons)

    if composition_score is not None:
        if composition_score < 60:
            comp_msgs.append("í˜„ì¬ êµ¬ë„ê°€ ë‹¤ì†Œ ë¶ˆì•ˆì •í•´ ë³´ì—¬ìš”. ì¸ë¬¼ ìœ„ì¹˜ë‚˜ ê°ë„ë¥¼ ì¡°ì •í•´ë³´ì„¸ìš”.")
        elif composition_score < 80:
            comp_msgs.append("ì¢‹ì•„ìš”! ì „ë°˜ì ìœ¼ë¡œ ê· í˜• ì¡íŒ êµ¬ë„ì˜ˆìš”. ì•½ê°„ì˜ ì¡°ì •ìœ¼ë¡œ ë” ì™„ë²½í•´ì§ˆ ìˆ˜ ìˆì–´ìš”.")
        else:
            comp_msgs.append("ì•„ì£¼ í›Œë¥­í•´ìš”! ì¸ë¬¼ ë°°ì¹˜ì™€ ì—¬ë°±ì´ ì•ˆì •ì ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.")

    # -------------------------------------------------------------------------
    # 3ï¸âƒ£ ê°ì„±(CLIP) ê´€ë ¨
    # -------------------------------------------------------------------------
    if emotion_score is not None:
        if emotion_score < 55:
            emo_msgs.append("ë ˆí¼ëŸ°ìŠ¤ì™€ ëŠë‚Œì´ ì¡°ê¸ˆ ë‹¬ë¼ìš”. ì¡°ëª… í†¤ì´ë‚˜ ìƒ‰ê°ì„ ì¡°ì •í•´ë³´ì„¸ìš”.")
        elif emotion_score < 75:
            emo_msgs.append("ëŠë‚Œì´ ê½¤ ë¹„ìŠ·í•´ìš”. í†¤ ì»¤ë¸Œë‚˜ ëŒ€ë¹„ë¥¼ ì‚´ì§ ì¡°ì ˆí•˜ë©´ ë” ê°€ê¹Œì›Œì§ˆ ê±°ì˜ˆìš”.")
        else:
            emo_msgs.append("ë ˆí¼ëŸ°ìŠ¤ì™€ ë¶„ìœ„ê¸°ê°€ ì˜ ë§ì•„ìš”! ê°ì„±ì ìœ¼ë¡œ ìœ ì‚¬í•œ ì´ë¯¸ì§€ë¥¼ ì˜ ë§Œë“¤ì—ˆì–´ìš”.")

    # -------------------------------------------------------------------------
    # 4ï¸âƒ£ ìš”ì•½(summary)
    # -------------------------------------------------------------------------
    if summary:
        summary_msgs.append(f"ğŸ“ {summary}")

    # -------------------------------------------------------------------------
    # 5ï¸âƒ£ ìµœì¢… êµ¬ì„± (ì¹´í…Œê³ ë¦¬ë³„ ì •ë¦¬)
    # -------------------------------------------------------------------------
    messages: List[str] = []
    if pose_msgs:
        messages.append("ğŸ•º [í¬ì¦ˆ ì¸ì‹]")
        messages.extend(f" - {m}" for m in pose_msgs)
    if comp_msgs:
        messages.append("\nğŸ“¸ [êµ¬ë„ ë¶„ì„]")
        messages.extend(f" - {m}" for m in comp_msgs)
    if emo_msgs:
        messages.append("\nğŸ’« [ê°ì„± ìœ ì‚¬ë„]")
        messages.extend(f" - {m}" for m in emo_msgs)
    if summary_msgs:
        messages.append("\nğŸ§¾ [ìš”ì•½]")
        messages.extend(f" - {m}" for m in summary_msgs)

    # ë¹„ì–´ ìˆì„ ê²½ìš° ê¸°ë³¸ ë¬¸ì¥
    if not messages:
        messages.append("ì¢‹ì•„ìš”! êµ¬ë„ì™€ ê°ì„± ëª¨ë‘ ì•ˆì •ì ìœ¼ë¡œ ë³´ì—¬ìš”. í•œ ë²ˆ ë” ì‹œë„í•´ë³¼ê¹Œìš”?")

    return messages
