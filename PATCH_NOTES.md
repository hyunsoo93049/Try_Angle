# TryAngle 패치 노트

## v1.4.1 - 2025-11-18 21:45

### 🔧 버그 수정 및 시스템 개선

#### 1. 사진 촬영 90도 회전 문제 해결 🔥 (최종 핵심 수정)
- **문제**: 사진을 찍으면 오른쪽으로 90도 회전되어 저장
  - 화면 프리뷰는 세로, 저장된 사진은 가로
  - 화면에 보이는 것 ≠ 캡처되는 것
- **근본 원인**: UIImage orientation은 메타데이터일 뿐
  - 실제 픽셀은 여전히 landscape (가로)
  - cropImage()가 픽셀 기준으로 자름 → 가로 기준 크롭
- **해결**: 크롭 전에 픽셀 회전
  1. fixedOrientation() → 픽셀을 실제로 회전 (세로)
  2. cropImage() → 세로 기준으로 자름
  3. 저장 → 올바른 방향 ✅

#### 2. 카메라 센서 좌표계 문제 완전 해결 🎯 (사용자 핵심 지적)
- **문제**: 세로로 들고 있는데 가로 기준으로 피드백
  - "위로 향하세요" → 가로로 들고 위로 들어야 맞음
  - 센서가 세로/가로를 인식하지 못함
- **근본 원인**: `fixedOrientation()` 호출로 orientation이 `.up`으로 변경
  - Vision이 "이미 올바른 방향"이라고 판단
  - 좌표 변환을 하지 않음 → 여전히 landscape 기준!
- **해결**: 실시간 분석에는 orientation `.right` 유지
  - CameraManager: `fixedOrientation()` 제거
  - Vision이 `.right`를 받아 자동으로 좌표 90도 회전
  - 저장할 때만 `fixedOrientation()` 호출

#### 2. 피드백 방향 로직 수정
- **문제**: "아래로 이동하세요" → 실제로는 위로 움직여야 맞음
  - 피드백 방향이 **완전히 반대**로 구현됨
- **해결**: 모든 방향 로직 수정
  - Y 위치: `current > target ? "위로" : "아래로"` → **"아래로" : "위로"** ✅
  - 기울기: `current > target ? "왼쪽" : "오른쪽"` → **"오른쪽" : "왼쪽"** ✅

#### 3. Vision 좌표계 오류 수정 (매우 중요 🔥)
- **문제**: "아래로 이동하세요" 메시지에 오른쪽으로 움직여야 맞음
  - iPhone 카메라 센서가 landscape로 장착되어 좌표계 90도 회전
  - VNImageRequestHandler에 이미지 orientation 미전달
  - Vision이 센서 기준 좌표계 사용 → X/Y축 뒤바뀜
- **해결**: 모든 Vision 요청에 이미지 orientation 전달
  - UIImage.cgImageOrientation extension 추가
  - VisionAnalyzer의 모든 요청에 orientation 파라미터 추가
  - 화면 좌표계와 Vision 좌표계 완전 일치
  - 위/아래/좌/우 피드백이 올바르게 작동

#### 4. 비율 감지 시스템 수정
- **문제**: 세로 사진의 비율이 잘못 감지됨
  - 16:9 세로 사진 (1080x1920) → 0.56으로 계산되어 1:1로 오인식
  - UIImage.size가 EXIF orientation이 적용된 크기를 반환
- **해결**: 긴 변 / 짧은 변으로 비율 계산
  - 세로/가로 무관하게 정확한 비율 인식
  - 16:9, 4:3, 1:1 모두 정확히 감지

#### 5. 방향 시스템 완전 제거
- **문제**: 디바이스 방향 감지가 불필요하고 혼란스러움
  - 앱은 portrait only로 작동
  - 카메라는 항상 portrait 모드로 고정
  - "핸드폰을 세로로 돌려주세요" 메시지가 잘못 표시됨
- **해결**: 비율 비교 시스템으로 변경
  - "카메라 비율을 X로 변경하세요" 피드백
  - 레퍼런스 비율과 현재 카메라 비율만 비교
  - DeviceOrientationManager 제거

#### 6. 4:3 비율 화면 표시 수정
- **문제**: 4:3 선택 시 전체 화면 사용 (비율 맞지 않음)
- **해결**: `screenWidth × 4/3`로 정확한 4:3 영역 표시
  - 위아래 마스크로 촬영 범위 명확히 표시

### 📋 기술적 변경사항
- ContentView.swift: 크롭 전에 `fixedOrientation()` 호출로 픽셀 회전
- Services/CameraManager.swift: `fixedOrientation()` 제거, orientation `.right` 유지
- Services/Comparison/FeedbackGenerator.swift: Y 위치, 기울기 방향 로직 반전
- Extensions/UIImage+Orientation.swift: cgImageOrientation 추가
- Services/Analysis/VisionAnalyzer.swift: 모든 Vision 요청에 orientation 전달
- Models/Feedback.swift: `CameraAspectRatio.detect()` 로직 개선
- Services/RealtimeAnalyzer.swift: 방향 감지 → 비율 비교로 전환
- Models/DeviceOrientation.swift: 사용 중단 (추후 제거 예정)

---

## v1.4.0 - 2025-11-18 20:52

### 🚀 대규모 시스템 개편

#### 1. 카메라 비율 시스템 완전 재설계
- **실제 iPhone 카메라 방식으로 변경**
  - 4:3 - 전체 화면 사용 (카메라 센서 기본 비율)
  - 1:1 - 정사각형, 화면 너비 기준
  - 16:9 - 와이드, 가장 좁은 높이
- **비율별 마스크 오버레이**
  - 캡처되지 않는 영역을 어둡게 표시 (0.7 opacity)
  - 위아래 마스크로 정확한 촬영 범위 시각화
  - 기본 카메라 앱과 동일한 UX 제공

#### 2. 프레이밍 분석 시스템 신규 도입 (핵심 개선)
- **FramingAnalyzer 추가** - 가장 중요한 개선
  - 레퍼런스 이미지의 구도를 정밀 분석
  - 인물 크기, 여백, 보이는 신체 부위 자동 감지
  - 6단계 구도 타입 자동 분류:
    - 전신 (fullBody)
    - 무릎샷 (threeQuarter)
    - 허리샷 (halfBody)
    - 상반신 (upperBody)
    - 헤드샷 (headAndShoulder)
    - 클로즈업 (closeUp)

- **구체적인 액션 제안**
  - 줌인/줌아웃 (정확한 배율 포함)
  - 카메라 가까이/멀리 이동
  - 비율 변경 제안
  - 레퍼런스와 현재 구도 정밀 비교

#### 3. 포즈 감지 시스템 고도화
- **부분 포즈 감지 지원**
  - 관절이 일부 가려져도 분석 가능
  - 레퍼런스에 없는 부위는 피드백하지 않음
  - 포즈 타입별 중요 부위 자동 정의

- **포즈 타입 기반 분석**
  - 전신: 머리, 어깨, 팔, 몸통, 다리 모두 체크
  - 상반신: 머리, 어깨, 팔, 몸통만 체크
  - 흉상: 머리, 어깨만 체크
  - 중요 부위 누락시에만 알림

#### 4. UI 전면 간소화
- **SimplifiedFeedbackOverlay 신규 컴포넌트**
  - 가장 중요한 피드백 1개만 표시
  - 완성도 퍼센트 및 프로그레스 바
  - 상태별 색상 코딩:
    - 빨강 (~50%) → 주황 (~70%) → 파랑 (~90%) → 초록 (90%+)

- **미니멀 컨트롤**
  - 상단: 비율, 그리드, 플래시만
  - 하단: 촬영, 카메라 전환만
  - 불필요한 버튼 제거로 집중도 향상

#### 5. 피드백 시스템 우선순위 재정의
- **새로운 우선순위:**
  1. 📐 프레이밍 (줌/거리) - 최우선
  2. 💪 포즈 (자세)
  3. 📍 위치 (좌우/상하)
  4. 📷 앵글, 🎨 구도, 👀 시선

- **프레이밍 피드백이 최우선으로 표시**
  - "화면을 확대해주세요 (인물이 너무 작아요)"
  - "카메라를 인물에게 가까이 이동하세요"
  - "비율을 4:3로 변경하세요"

### 🎨 UI/UX 개선
- 산만한 UI 요소 제거
- 피드백 메시지 간소화
- 레퍼런스 썸네일 뷰 추가 (선택적 표시)

### 🧠 분석 로직 개선
- 레퍼런스 기반 지능형 분석
- 구도 이해 능력 향상
- 부분적으로 보이는 포즈도 정확히 해석

### ⚡ 성능 최적화
- 프레이밍 분석 우선 처리로 빠른 피드백
- 중요하지 않은 분석 후순위 처리

---

## v1.3.0 - 2025-11-18 19:56

### 🎯 주요 개선사항

#### 피드백 시스템 대폭 개선
- **포즈 피드백 구체화**
  - 기존: "왼팔 각도 조정" → 변경: "왼팔을 더 올려주세요 (약 25도)"
  - 팔/다리 각도 차이를 숫자로 표시
  - 올리기/내리기, 굽히기/펴기 등 구체적인 방향 지시

- **피드백 안정성 개선**
  - "비교할 수 없습니다" 메시지가 한 번 표시되면 해결될 때까지 계속 유지
  - 고정 피드백(Sticky Feedback) 시스템 구현
  - 5번 연속 해결 확인 후에만 제거 (깜빡임 방지)

- **위/아래 피드백 방향 수정**
  - 인물 기준 → **카메라 기준**으로 변경
  - "조금 더 위쪽으로" → "카메라를 위로 이동하세요"
  - 훨씬 직관적인 가이드 제공

#### 완료 이펙트 추가
- 피드백 완료 시 초록색 "완료!" 메시지 표시
- 1.5초 동안 표시 후 페이드아웃 애니메이션
- 성취감을 주는 시각적 피드백

#### 화면 비율 & 여백 감지
- **카메라 비율 자동 감지** (16:9, 4:3, 1:1)
- **비율 선택 UI** 추가 (상단 오른쪽)
- **과도한 여백 감지**
  - 15% 이상 여백 시 "줌인하세요" 피드백
  - 상/하/좌/우 여백 개별 분석

#### 카테고리별 체크리스트
- 6가지 평가 카테고리 시각화
  1. 💪 포즈 (1순위)
  2. 📍 인물 위치 (2순위)
  3. 🔍 프레이밍 (3순위)
  4. 📷 카메라 앵글 (4순위)
  5. 🎨 구도 (5순위)
  6. 👀 시선 (6순위)
- 실시간 체크/해제 애니메이션
- 우선순위 배지 표시

### 🐛 버그 수정
- 사진 저장 시 회전 버그 수정
- PHPhotoLibrary 사용으로 방향 정보 유지

### ⚙️ 성능 개선
- 프레임 분석 주기: 60fps → 10fps (민감도 감소)
- 히스테리시스 임계값: 3프레임 → 10프레임 (약 1초)
- 허용 오차 증가:
  - 위치 X/Y: 5% → 8%
  - 거리: 20cm → 30cm
  - 기울기: 3도 → 5도
  - 얼굴 각도: 10도 → 15도

---

## v1.2.0 - 2025-11-18 17:00

### 🆕 새로운 기능
- **V1 핵심 컴포넌트 통합**
  - CompositionAnalyzer: 3분할법 기반 구도 분석
  - CameraAngleDetector: 카메라 앵글 자동 감지 (하이앵글/아이레벨/로우앵글/더치틸트)
  - AdaptivePoseComparator: 적응형 포즈 비교 (전신/상반신/얼굴 자동 감지)
  - GapAnalyzer: 차이 분석 및 우선순위 계산
  - FeedbackGenerator: 실시간 피드백 생성

- **추가 분석 기능**
  - GazeTracker: 시선 방향 추적
  - DepthEstimator: 거리 추정 (얼굴 크기 기반)
  - 모듈화된 VisionAnalyzer

### 🎨 UI 개선
- 실시간 피드백 오버레이
- 완성도 점수 표시 (0~100%)
- 진행 상황 프로그레스 바

---

## v1.1.0 - 2025-11-17

### 🆕 새로운 기능
- 실시간 프레임 분석 시스템
- 레퍼런스 이미지 기반 비교
- 기본 피드백 시스템

### 🎨 UI
- 카메라 프리뷰
- 그리드 오버레이
- 플래시/카메라 전환 기능

---

## v1.0.0 - 2025-11-16

### 🎉 초기 릴리즈
- 프로젝트 생성
- 기본 카메라 기능
- Vision 프레임워크 통합
- 얼굴/포즈 감지 기능
